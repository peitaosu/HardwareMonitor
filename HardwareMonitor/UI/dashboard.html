<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Hardware Monitor</title>
    <link rel="stylesheet" href="tabler/dist/css/tabler.min.css">
    <link rel="stylesheet" href="tabler/dist/css/tabler-flags.min.css">
    <link rel="stylesheet" href="tabler-icons/tabler-icons.min.css">
    <link rel="stylesheet" href="tabler/dist/libs/apexcharts/dist/apexcharts.css">

    <link rel="stylesheet" href="css/custom.css">
</head>

<body data-bs-theme="dark">
    <div class="layout-fluid">
        <div class="page">
            <header id="main_navbar" class="navbar navbar-expand-md sticky-top d-print-none">
                <div class="container-xl">
                    <h1 class="navbar-brand navbar-brand-autodark d-none-navbar-horizontal pe-0 pe-md-3">
                        <i class="ti ti-heart-rate-monitor"></i> Hardware Monitor
                    </h1>

                    <div class="navbar-nav flex-row order-md-last">
                        <div class="nav-item">
                            <a id="dialog_mini" href="#" class="nav-link d-flex lh-1 text-reset p-0">
                                <i class="ti ti-arrow-bar-down"></i>
                            </a>
                        </div>
                        <div class="nav-item">
                            <a id="dialog_center" href="#" class="nav-link d-flex lh-1 text-reset p-0">
                                <i class="ti ti-window-minimize"></i>
                            </a>
                        </div>
                        <div class="nav-item">
                            <a id="dialog_max" href="#" class="nav-link d-flex lh-1 text-reset p-0">
                                <i class="ti ti-window-maximize"></i>
                            </a>
                        </div>
                        <div class="nav-item">
                            <a id="dialog_x" href="#" class="nav-link d-flex lh-1 text-reset p-0">
                                <i class="ti ti-square-x"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </header>
            <div class="page-wrapper">
                <div class="page-body">
                    <div class="container-xl">
                        <div class="row row-deck row-cards">
                            <!--Machine-->
                            <div class="col-12 col-md-4 col-xl-4">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row align-items-center">
                                            <div class="col-auto">
                                                <span class="text-white avatar">
                                                    <img src="image/machine.svg" />
                                                </span>
                                            </div>
                                            <div class="col">
                                                <div class="text-secondary">
                                                    Machine
                                                </div>
                                                <div class="font-weight-medium">
                                                    <span id="name_machine"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--IP-->
                            <div class="col-12 col-md-4 col-xl-4">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row align-items-center">
                                            <div class="col-auto">
                                                <span class="text-white avatar">
                                                    <img src="image/ip.svg" />
                                                </span>
                                            </div>
                                            <div class="col">
                                                <div class="text-secondary">
                                                    IPv4
                                                </div>
                                                <div class="font-weight-medium">
                                                    <span id="name_ipv4"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--Motherboard-->
                            <div class="col-12 col-md-4 col-xl-4">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row align-items-center">
                                            <div class="col-auto">
                                                <span class="text-white avatar">
                                                    <img src="image/motherboard.svg" />
                                                </span>
                                            </div>
                                            <div class="col">
                                                <div class="text-secondary">
                                                    Motherboard
                                                </div>
                                                <div class="font-weight-medium">
                                                    <span id="name_motherboard"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--CPU-->
                            <div class="col-12 col-md-8 col-xl-8">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="card-stamp">
                                            <div class="card-stamp-icon">
                                                <img src="image/cpu.svg" />
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="d-flex">
                                                <h3 class="card-title">CPU Usage</h3>
                                                <div class="ms-auto">
                                                    <span id="name_cpu"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="chart-cpu-load">
                                    </div>
                                </div>
                            </div>
                            <!--RAM-->
                            <div class="col-12 col-md-3 col-xl-3">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row align-items-center">
                                            <div class="col-auto">
                                                <span class="text-white avatar">
                                                    <img src="image/ram.svg" />
                                                </span>
                                            </div>
                                            <div class="col">
                                                <div class="text-secondary">
                                                    RAM
                                                </div>
                                                <div class="font-weight-medium">
                                                    <span id="name_ram"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--GPU-->
                            <div class="col-12 col-md-3 col-xl-3">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row align-items-center">
                                            <div class="col-auto">
                                                <span class="text-white avatar">
                                                    <img src="image/gpu.svg" />
                                                </span>
                                            </div>
                                            <div class="col">
                                                <div class="text-secondary">
                                                    GPU
                                                </div>
                                                <div class="font-weight-medium">
                                                    <span id="name_gpu"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--FAN-->
                            <div class="col-12 col-md-3 col-xl-3">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row align-items-center">
                                            <div class="col-auto">
                                                <span class="text-white avatar">
                                                    <img src="image/fan.svg" />
                                                </span>
                                            </div>
                                            <div class="col">
                                                <div class="text-secondary">
                                                    FAN
                                                </div>
                                                <div class="font-weight-medium">
                                                    <span id="name_fan"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--Ethernet-->
                            <div class="col-12 col-md-3 col-xl-3">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row align-items-center">
                                            <div class="col-auto">
                                                <span class="text-white avatar">
                                                    <img src="image/port.svg" />
                                                </span>
                                            </div>
                                            <div class="col">
                                                <div class="text-secondary">
                                                    Ethernet
                                                </div>
                                                <div class="font-weight-medium">
                                                    $Ethernet
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--HDD-->
                            <div class="col-12 col-md-3 col-xl-3">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row align-items-center">
                                            <div class="col-auto">
                                                <span class="text-white avatar">
                                                    <img src="image/hdd.svg" />
                                                </span>
                                            </div>
                                            <div class="col">
                                                <div class="text-secondary">
                                                    HDD
                                                </div>
                                                <div class="font-weight-medium">
                                                    $HDD
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--SSD-->
                            <div class="col-12 col-md-3 col-xl-3">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row align-items-center">
                                            <div class="col-auto">
                                                <span class="text-white avatar">
                                                    <img src="image/hdd.svg" />
                                                </span>
                                            </div>
                                            <div class="col">
                                                <div class="text-secondary">
                                                    SSD
                                                </div>
                                                <div class="font-weight-medium">
                                                    $SSD
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="tabler/dist/js/tabler.min.js"></script>
    <script src="tabler/dist/libs/apexcharts/dist/apexcharts.min.js"></script>

    <script>
        "use strict";
        var machine_id = 0;
        function GetHardware() {
            window.chrome.webview.postMessage({
                "Type": "GET",
                "Source": "Dashboard",
                "Target": "Hardware",
                "Message": {
                    "MachineID": machine_id
                }
            });
        }
        function GetMachine() {
            window.chrome.webview.postMessage({
                "Type": "GET",
                "Source": "Dashboard",
                "Target": "Machine",
                "Message": {}
            });
        }
        function SendClickEvent(target, key = "left", double = false) {
            window.chrome.webview.postMessage({
                "Type": "CLICK",
                "Source": "Dashboard",
                "Target": target,
                "Message": {
                    "Double": double,
                    "Key": key
                }
            });
        }
        function MoveWindow(event) {
            window.chrome.webview.postMessage({
                "Type": "MOUSEMOVE",
                "Target": "body",
                "Message": {
                    "X": event.offsetX,
                    "Y": event.offsetY
                }
            });
        }
        GetMachine();
        GetHardware();

        var CPU_Sensors = {};
        var CPU_Sensors_TimeList = [];
        document.querySelectorAll(".nav-link").forEach(element => {
            element.addEventListener("click", event => {
                var target = event.currentTarget;
                switch (target.id) {
                    case "dialog_mini":
                        SendClickEvent("Min");
                        break;
                    case "dialog_center":
                        SendClickEvent("Center");
                        break;
                    case "dialog_max":
                        SendClickEvent("Max");
                        break;
                    case "dialog_x":
                        SendClickEvent("X");
                        break;
                    default:
                        break;
                }
            });
        });

        const main_navbar = document.querySelector("#main_navbar");
        const body = document.querySelector("body");
        main_navbar.addEventListener("mousedown", () => {
            window.chrome.webview.postMessage({
                "Type": "MOUSEDOWN",
                "Target": main_navbar.id,
            });
            body.addEventListener("mousemove", MoveWindow);
        });
        main_navbar.addEventListener("mouseup", () => {
            window.chrome.webview.postMessage({
                "Type": "MOUSEUP",
                "Target": main_navbar.id,
            });
            body.removeEventListener("mousemove", MoveWindow);
        });
        main_navbar.addEventListener("dblclick", () => {
            SendClickEvent("Nav", "left", true);
        });

        var chart_cpu_load_options = {
            chart: {
                type: "area",
                fontFamily: 'inherit',
                height: 288,
                toolbar: {
                    show: false,
                },
                sparkline: {
                    enabled: true
                },
                animations: {
                    enabled: true,
                    easing: 'easeinout',
                    speed: 5000,
                    animateGradually: {
                        enabled: true,
                        delay: 150
                    },
                    dynamicAnimation: {
                        enabled: true,
                        speed: 5000
                    }
                },
            },
            fill: {
                opacity: 1,
            },
            stroke: {
                curve: "smooth",
            },
            series: [{ data: [] }],
            tooltip: {
                theme: 'dark'
            },
            xaxis: {
                labels: {
                    padding: 0,
                },
                tooltip: {
                    enabled: false
                },
                axisBorder: {
                    show: false,
                },
                type: 'datetime',
            },
            yaxis: {
                max: 100
            },
            labels: [],
            legend: {
                show: false
            },
            point: {
                show: false
            },
        }

        var chart_cpu_load = new ApexCharts(document.getElementById('chart-cpu-load'), chart_cpu_load_options);
        chart_cpu_load.render();

        async function update_chart_cpu_load() {
            return new Promise((resolve, reject) => {
                const chart_data = [];
                for (const [id, sensor] of Object.entries(CPU_Sensors)) {
                    chart_data.push({
                        name: [...new Set(sensor.name)].pop(),
                        data: sensor.data.slice(-10)
                    });
                }
                chart_cpu_load.updateSeries(chart_data, true);
                chart_cpu_load.updateOptions({ labels: CPU_Sensors_TimeList.slice(-10) });
            });
        }

        window.chrome.webview.addEventListener("message", event => {
            var data = event.data;
            switch (data.Type) {
                case "Machine":
                    document.querySelector("#name_machine").innerHTML = data.Data.MachineName;
                    document.querySelector("#name_ipv4").innerHTML = data.Data.URI;
                    machine_id = data.Machine;
                    break;
                case "Hardware":
                    CPU_Sensors_TimeList.push(Date.now());
                    data.Data.Hardware.forEach(hardware => {
                        switch (hardware.Type) {
                            case "Motherboard":
                                document.querySelector("#name_motherboard").innerHTML = hardware.Name;
                                break;
                            case "Cpu":
                                document.querySelector("#name_cpu").innerHTML = hardware.Name;
                                for (const [id, sensor] of Object.entries(hardware.Sensors["Load"])) {
                                    if (!(id in CPU_Sensors)) {
                                        CPU_Sensors[id] = {
                                            "name": [],
                                            "data": []
                                        };
                                    }
                                    for (const [name, value] of Object.entries(sensor)) {
                                        if (name != "CPU Total") continue;
                                        CPU_Sensors[id]["name"].push(name);
                                        CPU_Sensors[id]["data"].push(value.Value);
                                    }
                                }
                                break;
                            case "Memory":
                                document.querySelector("#name_ram").innerHTML = hardware.Name;
                                break;
                            case "GpuAmd":
                                document.querySelector("#name_gpu").innerHTML = hardware.Name;
                                break;
                            case "GpuNvidia":
                                document.querySelector("#name_gpu").innerHTML = hardware.Name;
                                break;
                            default:
                                break;
                        }
                    });
                    update_chart_cpu_load();
                    break;
                default:
                    break;
            }
        });



    </script>

</body>

</html>